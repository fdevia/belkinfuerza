(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{120:function(e,n,s){},121:function(e,n,s){},122:function(e,n,s){"use strict";s.r(n);var t=s(0),a=s(1),c=s.n(a),o=s(48),r=s.n(o),i=(s(60),s(3)),l=s(53),d=s(24),u=s(9),j=s.n(u),m=s(17),h=s(49),p=s(50),b=s(54),v=s(52),f=(s(62),s(63),function(e){var n=e.split("-"),s=n[0].substring(2,5),t=n[1],a=n[2].substring(0,2);return"".concat(a,"/").concat(t,"/").concat(s)});var g=function(e){var n=function(){var n=e.conversacion.mensajes[e.conversacion.mensajes.length-1];return e.conversacion.mensajeBuscado&&(n=e.conversacion.mensajeBuscado),n?"usuario"===n.fuente?Object(t.jsx)("h6",{className:"ultimoMensaje",children:n.texto}):"bot"===n.fuente?Object(t.jsxs)("h6",{className:"ultimoMensaje",children:["Bot: ",n.texto]}):Object(t.jsxs)("h6",{className:"ultimoMensaje",children:["T\xfa: ",n.texto]}):n&&n.fecha?""===n.agente?Object(t.jsx)("h6",{className:"ultimoMensaje",children:n.texto}):Object(t.jsxs)("h6",{className:"ultimoMensaje",children:[n.agente,": ",n.texto]}):Object(t.jsx)("h6",{className:"ultimoMensaje",children:"Cargando..."})},s=function(){var n=e.conversacion.mensajes[e.conversacion.mensajes.length-1];return Object(t.jsx)(c.a.Fragment,{children:n&&("usuario"===n.fuente||"bot"===n.fuente)&&Object(t.jsx)("div",{className:"pendiente"})})},a=function(){return Object(t.jsxs)("div",{className:"conversacion",onClick:function(){return e.handleClick(e.conversacion)},children:[Object(t.jsx)("p",{className:"fecha",children:f(e.conversacion.mensajes[e.conversacion.mensajes.length-1].fecha)}),Object(t.jsx)("div",{className:"contenedorNombre",children:Object(t.jsx)("h2",{className:"tituloConversacion",children:e.conversacion.nameUsr||e.conversacion.numTel})}),n(),s()]})};return Object(t.jsxs)(c.a.Fragment,{children:[e.selected&&Object(t.jsxs)(c.a.Fragment,{children:[(e.conversacion.id&&e.conversacion.id===e.selected.id||e.conversacion._id&&e.conversacion._id===e.selected._id)&&Object(t.jsxs)("div",{className:"conversacion conversacionSeleccionada",onClick:function(){return e.handleClick(e.conversacion)},children:[Object(t.jsx)("p",{className:"fecha",children:f(e.conversacion.mensajes[e.conversacion.mensajes.length-1].fecha)}),e.conversacion.activa&&Object(t.jsx)("div",{className:"activa"}),Object(t.jsx)("div",{className:"contenedorNombre",children:Object(t.jsx)("h2",{className:"tituloConversacion",children:e.conversacion.createdByUserId||e.conversacion.nameUsr})}),n(),s()]}),!(e.conversacion.id&&e.conversacion.id===e.selected.id||e.conversacion._id&&e.conversacion._id===e.selected._id)&&a()]}),!e.selected&&a()]})};var O=function(e){return Object(t.jsx)("div",{className:"independentScroll",children:Object(t.jsxs)("div",{className:"margenLista",children:[e.historial&&Object(t.jsx)("div",{className:"espacioEnBlanco"}),e.conversaciones.map((function(n){return Object(t.jsx)(g,{selected:e.selected,conversacion:n,handleClick:e.handleClick},n._id)}))]})})},x=(s(64),s(65),s.p+"static/media/backArrow.06af44e7.svg"),C=s.p+"static/media/options.502312f9.svg",N=(s(66),s.p+"static/media/close.da5c4222.svg");var S=function(e){return Object(t.jsxs)("div",{className:"modalAgentes",children:[Object(t.jsx)("button",{className:"buttonClose",onClick:e.handleClose,children:Object(t.jsx)("img",{className:"closeIcon",src:N,alt:""})}),e.agentes.map((function(n){return Object(t.jsx)("div",{className:"container-fluid agentesContainer",children:Object(t.jsxs)("div",{onClick:function(){e.handleTransferir(n.cedula,e.selected.numTelUsr),e.handleClose()},className:"row agenteContainer",children:[Object(t.jsx)("h2",{className:"nombre",children:n.name}),"true"===n.logged&&Object(t.jsx)("h2",{className:"estadoConectado",children:"DISPONIBLE"}),"false"===n.logged&&Object(t.jsx)("h2",{className:"estadoDesconectado",children:"DESCONECTADO"})]})})}))]})},k=s(51),y=s.n(k);var T=function(e){var n=Object(a.useState)(!1),s=Object(i.a)(n,2),o=s[0],r=s[1],l=Object(a.useState)(!1),d=Object(i.a)(l,2),u=d[0],j=d[1],m=Object(a.useState)([]),h=Object(i.a)(m,2),p=h[0],b=h[1],v=function(){fetch("/mongo/agentesstatus/".concat(e.currentUser.id),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){e.json().then((function(e){return b(e)}))})),j(!u),r(!1)};return Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("div",{className:"contenedorTitulo",children:Object(t.jsxs)("div",{className:"fondoBlanco d-flex bd-highlight",children:[Object(t.jsx)("button",{className:"backButton bd-highlight",onClick:e.handleBack,children:Object(t.jsx)("img",{src:x,alt:"",className:"backArrow"})}),Object(t.jsx)("h1",{className:"title bd-highlight",children:e.selected.createdByUserId||e.selected.nameUsr}),!e.historial&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("button",{className:"opcionesButton ml-auto bd-highlight",onClick:function(){r(!o)},children:Object(t.jsx)("img",{src:C,alt:"options",className:"opcionesConversacion"})}),o&&Object(t.jsxs)("div",{className:"menuConv",children:[Object(t.jsx)("input",{className:"inputfile",type:"file",name:"file",id:"file",onChange:function(n){r(!1),e.setEsperando(!0);var s=n.target.files.item(0),t=new FormData;t.append("name","mateo"),t.append("file",s),y.a.post("/chatcenterkit/agentmessage?usrtelnum=".concat(e.selected.numTelUsr,"&cedula=").concat(e.currentUser.id),t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(n){var s=n.data,t=s.find((function(n){return n.numTelUsr===e.selected.numTelUsr}));e.setConversaciones(s),e.setSelected(t),document.getElementById("sendMessageSound").play(),e.setEsperando(!1)})).catch((function(e){return console.log(e)}))}}),!e.esperando&&Object(t.jsx)("label",{className:"menuTitleConv",for:"file",children:"Adjuntar Archivo"}),e.esperando&&Object(t.jsx)("label",{className:"menuTitleConvEsperando",children:"Enviando archivo..."}),Object(t.jsx)("div",{onClick:v,className:"menuTitleConv",children:"Transferir Conversaci\xf3n"}),Object(t.jsx)("div",{onClick:function(){return e.handleTerminarConversacion(e.selected)},id:"terminarConv",className:"menuTitleConv",children:"Terminar Conversacion"})]})]})]})}),u&&Object(t.jsx)(S,{handleClose:v,agentes:p,handleTransferir:e.handleTransferir,selected:e.selected})]})},w=(s(83),s.p+"static/media/sendIcon.306fdb06.svg"),M=s.p+"static/media/quickMessages.bdf7028c.svg";var U=function(e){var n=Object(a.useRef)(),s=Object(a.useState)(!1),c=Object(i.a)(s,2),o=c[0],r=c[1],l=function(){e.sendMessage(n.current.value,e.selected.numTelUsr),n.current.value=""},d=function(e){n.current.value=e,r(!1)};return Object(t.jsx)("div",{className:"myInputContainer",children:Object(t.jsxs)("div",{className:"row",children:[!e.esperando&&Object(t.jsx)("input",{className:"myInput",type:"text",disabled:e.esperando,ref:n,onKeyPress:function(e){"Enter"===e.key&&l()}}),e.esperando&&Object(t.jsx)("input",{className:"myDisabledInput",type:"text",disabled:e.esperando,ref:n,value:"Enviando Mensaje, porfavor espere..."}),Object(t.jsx)("button",{onClick:l,disabled:e.esperando,className:"sendButton",children:Object(t.jsx)("img",{src:w,alt:"Boton Enviar",className:"iconoEnviar"})}),Object(t.jsx)("div",{className:"fondoBotonRapido",children:Object(t.jsx)("button",{onClick:function(){r(!o)},className:"quickSendContainer",children:Object(t.jsx)("img",{className:"quickSend",src:M,alt:""})})}),o&&Object(t.jsxs)("div",{className:"contenedorMensajesRapidos",children:[Object(t.jsxs)("div",{onClick:function(){return d("Buenos D\xedas, mi nombre es ".concat(e.usuario," de Serv. \xbfEn que puedo ayudarlo el d\xeda de hoy?"))},class:"mensajeRapido",children:["Buenos D\xedas, mi nombre es ",e.usuario," de Serv. \xbfEn que puedo ayudarlo el d\xeda de hoy?"]}),Object(t.jsx)("div",{children:Object(t.jsx)("div",{onClick:function(){return d("\xbfPuedo ayudarlo con alguien m\xe1s?")},class:"mensajeRapido",children:"\xbfPuedo ayudarlo con alguien m\xe1s?"})}),Object(t.jsx)("div",{children:Object(t.jsx)("div",{onClick:function(){return d("Ha sido un placer atenderlo el d\xeda de hoy. Hasta luego.")},class:"mensajeRapido",children:"Ha sido un placer atenderlo el d\xeda de hoy. Hasta luego."})})]})]})})},E=s.p+"static/media/ChatCenterLogo.2fd93857.svg",B=(s(84),function(e){var n=e.split("-"),s=n[0].substring(2,5),t=n[1],a=n[2],c=a.substring(0,2),o=a.substring(3,8);return"".concat(c,"/").concat(t,"/").concat(s," ").concat(o)});var I=function(e){return Object(t.jsxs)("div",{className:"mensajeRecibido",children:[e.mensaje.parts&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("p",{className:"texto",children:e.mensaje.texto}),Object(t.jsx)("p",{className:"fechaMensaje",children:B(e.mensaje.fecha)})]}),!e.mensaje.parts&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("p",{className:"texto",children:e.mensaje.texto}),Object(t.jsx)("p",{className:"fechaMensaje",children:B(e.mensaje.fecha)})]})]})},D=(s(85),function(e){var n=e.split("-"),s=n[0].substring(2,5),t=n[1],a=n[2],c=a.substring(0,2),o=a.substring(3,8);return"".concat(c,"/").concat(t,"/").concat(s," ").concat(o)});var H=function(e){return Object(t.jsxs)("div",{id:e.mensaje.mensajeid,className:"mensajeEnviado ml-auto",children:[!e.mensaje.url&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("p",{className:"texto",children:e.mensaje.texto}),Object(t.jsx)("h6",{className:"agente",children:e.mensaje.agente||"Bot"}),Object(t.jsx)("p",{className:"fechaMensaje",children:D(e.mensaje.fecha)})]}),("image/jpeg"===e.mensaje.mimetype||"image/gif"===e.mensaje.mimetype||"image/png"===e.mensaje.mimetype)&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("img",{className:"imagenAdjunta",src:e.mensaje.url,alt:""}),Object(t.jsx)("h6",{className:"agente",children:e.mensaje.agente}),Object(t.jsx)("p",{className:"fechaMensaje",children:D(e.mensaje.fecha)})]}),"application/pdf"===e.mensaje.mimetype&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("iframe",{title:"myfrme01FDC",className:"imagenAdjunta",src:e.mensaje.url,type:"application/pdf"}),Object(t.jsx)("h6",{className:"agente",children:e.mensaje.agente}),Object(t.jsx)("p",{className:"fechaMensaje",children:D(e.mensaje.fecha)})]}),e.mensaje.parts&&"inline"===e.mensaje.parts[0].partType&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("p",{className:"texto",children:e.mensaje.parts[0].payload.content}),Object(t.jsx)("h6",{className:"agente",children:e.mensaje.parts[1].payload.content}),Object(t.jsx)("p",{className:"fechaMensaje",children:D(e.mensaje.fecha)})]}),e.mensaje.parts&&"attachment"===e.mensaje.parts[0].partType&&"image"===e.mensaje.parts[0].payload.type.substring(0,5)&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("img",{className:"imagenAdjunta",src:e.mensaje.parts[0].payload._downloadURL,alt:""}),Object(t.jsx)("h6",{className:"agente",children:e.mensaje.text}),Object(t.jsx)("p",{className:"fechaMensaje",children:D(e.mensaje.fecha)})]}),e.mensaje.parts&&"attachment"===e.mensaje.parts[0].partType&&"application/pdf"===e.mensaje.parts[0].payload.type&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)("iframe",{title:"myfrme02FDC",className:"imagenAdjunta",src:e.mensaje.parts[0].payload._downloadURL,type:"application/pdf"}),Object(t.jsx)("h6",{className:"agente",children:e.mensaje.texto}),Object(t.jsx)("p",{className:"fechaMensaje",children:D(e.mensaje.fecha)})]})]})},A=(s(86),s(87),function(e){var n=e.split("-"),s=n[0].substring(2,5),t=n[1],a=n[2],c=a.substring(0,2),o=a.substring(3,8);return"".concat(c,"/").concat(t,"/").concat(s," ").concat(o)});var F=function(e){return Object(t.jsxs)("div",{className:"mensajeServidor",children:[Object(t.jsx)("h6",{className:"textoServidor",children:e.mensaje.texto}),Object(t.jsx)("p",{className:"fechaMensajeServidor",children:A(e.mensaje.fecha)})]})};var L=function(e){var n=Object(a.useRef)(),s=Object(a.useRef)();Object(a.useEffect)((function(){var n=document.getElementById("div");(n.scrollTop=n.scrollHeight,e.selected.mensajeBuscado)&&(document.getElementById(e.selected.mensajeBuscado.mensajeid).scrollIntoView(),n.scrollTop=n.scrollTop-63)}));var c=function(e){return e.recibido||"bot"===e.fuente?Object(t.jsx)(F,{mensaje:e}):e.recibido||"usuario"===e.fuente?Object(t.jsx)(I,{mensaje:e}):Object(t.jsx)(H,{mensaje:e})};return Object(t.jsxs)("div",{id:"div",className:"containerMessages",ref:s,children:[e.selected.mensajes.map((function(e,n){return Object(t.jsx)("div",{children:c(e)},n)})),Object(t.jsx)("div",{id:"bottom",ref:n})]})};var R=function(e){return Object(t.jsxs)("div",{className:"fondoGris",children:[e.selected&&Object(t.jsxs)(c.a.Fragment,{children:[Object(t.jsx)(T,{selected:e.selected,currentUser:e.currentUser,handleBack:e.handleBack,handleTerminarConversacion:e.handleTerminarConversacion,historial:e.historial,handleTransferir:e.handleTransferir,setSelected:e.setSelected,setConversaciones:e.setConversaciones,esperando:e.esperando,setEsperando:e.setEsperando}),Object(t.jsx)(L,{selected:e.selected,historial:e.historial}),!e.historial&&Object(t.jsx)(U,{selected:e.selected,sendMessage:e.sendMessage,usuario:e.currentUser.nombre,esperando:e.esperando,setEsperando:e.setEsperando})]}),!e.selected&&Object(t.jsxs)("div",{className:"contenedorBienvenida",children:[Object(t.jsx)("img",{src:E,alt:"Chat Center Logo",className:"logo"}),Object(t.jsxs)("h1",{className:"tituloSeleccionaAlgo",children:["\xa1Bienvenido ",e.currentUser.nombre,"!"]}),Object(t.jsx)("p",{children:"Escoge una conversaci\xf3n para empezar a chatear."})]})]})},P=(s(88),s(89),s.p+"static/media/ChatCenterLogo.2fd93857.svg"),_=s.p+"static/media/options.502312f9.svg",q=s.p+"static/media/lupa.91300910.svg";var G=function(e){var n=Object(a.useRef)(),s=Object(a.useState)(!1),c=Object(i.a)(s,2),o=c[0],r=c[1],l=function(){e.setHistorial(!0),e.setSelected(void 0),e.setConversaciones([]),fetch("/mongo/getMyConversationsHistorial/".concat(e.currentUser.id),{method:"GET"}).then((function(n){n.json().then((function(n){e.setConversaciones(n)}))})),r(!1)},d=function(){""===n.current.value?l():fetch("/mongo/conversacionessearchtext/".concat(e.currentUser.id,"/").concat(n.current.value),{method:"GET"}).then((function(n){n.json().then(function(){var n=Object(m.a)(j.a.mark((function n(s){var t,a,c,o;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log(s),t=[],n.t0=j.a.keys(s);case 3:if((n.t1=n.t0()).done){n.next=15;break}return a=n.t1.value,n.next=7,fetch("/mongo/conversacion/".concat(s[a].usrtelnum),{method:"GET"});case 7:return c=n.sent,n.next=10,c.json();case 10:(o=n.sent).mensajeBuscado=s[a],t.push(o),n.next=3;break;case 15:e.setConversaciones(t);case 16:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}))};return Object(t.jsx)("div",{className:"contenedor",children:Object(t.jsxs)("div",{className:"flex-row",children:[Object(t.jsx)("img",{src:P,alt:"Company Logo",className:"logoEmpresa"}),Object(t.jsx)("button",{className:"optionsButton float-right",onClick:function(){r(!o)},children:Object(t.jsx)("img",{src:_,alt:"Options Icon",className:"optionsIcon"})}),e.historial&&Object(t.jsxs)("div",{className:"contenedorBuscar",children:[Object(t.jsx)("input",{type:"text",className:"inputBuscar",ref:n,onKeyPress:function(e){"Enter"===e.key&&d()}}),Object(t.jsx)("button",{onClick:d,className:"lupa",children:Object(t.jsx)("img",{className:"lupaIcon",src:q,alt:""})})]}),o&&Object(t.jsxs)("div",{className:"menu",children:[!e.historial&&Object(t.jsx)("div",{className:"menuTitle",onClick:l,children:"Historial"}),e.historial&&Object(t.jsx)("div",{className:"menuTitle",onClick:function(){e.setHistorial(!1),r(!1),e.setSelected(void 0)},children:"Inicio"}),Object(t.jsx)("div",{className:"menuTitle",onClick:function(){fetch("/auth/logout/".concat(e.currentUser.id),{method:"POST"}),e.logout(void 0),e.setSelected(void 0),r(!1),sessionStorage.clear()},children:"Cerrar Sesion"})]})]})})},z=s.p+"static/media/sendMessage.06bebb04.mp3",J=s.p+"static/media/newMessage.b8181d53.mp3",W=s.p+"static/media/newMessageAbierto.be5a4e84.mp3",K=s.p+"static/media/newConversacion.f27ac64e.mp3",V=s(23),$=s.n(V);function Q(){var e=window;return{width:e.innerWidth,height:e.innerHeight}}function X(e,n){if(e.mensajes[e.mensajes.length-1]&&n.mensajes[n.mensajes.length-1]){var s=e.mensajes[e.mensajes.length-1].fecha.split("-"),t=s[0].substring(0,5),a=s[1],c=s[2],o=c.substring(0,2),r=c.substring(3,5),i=c.substring(6,8),l=c.substring(9,11),d=new Date(parseInt(t),parseInt(a)-1,parseInt(o),parseInt(r),parseInt(i),parseInt(l)),u=n.mensajes[n.mensajes.length-1].fecha.split("-"),j=u[0].substring(0,5),m=u[1],h=u[2],p=h.substring(0,2),b=h.substring(3,5),v=h.substring(6,8),f=h.substring(9,11),g=new Date(parseInt(j),parseInt(m)-1,parseInt(p),parseInt(b),parseInt(v),parseInt(f));return d.getTime()>g.getTime()?-1:d.getTime()<g.getTime()?1:0}return 0}var Y=function(e){Object(b.a)(s,e);var n=Object(v.a)(s);function s(e){var a;return Object(h.a)(this,s),(a=n.call(this,e)).socket=$()("https://my-chat-kit.herokuapp.com/"),a.handleResize=function(){a.setState({windowDimensions:Q()})},a.handleClose=function(){var e=Object(m.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:navigator.sendBeacon("/auth/logout/".concat(a.props.currentUser.id),{}),n.preventDefault();case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),a.handleTerminarConversacion=function(e){fetch("/mongo/terminarconversacion/".concat(e.numTelUsr,"/").concat(a.props.currentUser.id),{method:"POST"}).then((function(e){a.pedirConversaciones()})),a.setSelected(void 0),a.unsuscribeDeConversacion(e.numTelUsr)},a.handleTransferir=function(e,n){fetch("/chatcenterkit/transferirAgente/".concat(a.props.currentUser.id,"/").concat(e,"/").concat(n),{method:"POST"}).then((function(e){a.pedirConversaciones()})),a.setSelected(void 0),a.unsuscribeDeConversacion(n)},a.configurarSocket=function(){a.socket.on("connect_error",(function(e){alert("No se puede conectar con el servidor. Haz click en aceptar para volver a intentar.")})),a.socket.on("connect",(function(){console.log("Main socket opnened"),a.socket.emit("identificacion",a.props.currentUser.id),a.pedirConversaciones()})),a.socket.on("newConversation",(function(e){console.log("newConversation"),document.getElementById("newConversacionSound").play(),a.pedirConversaciones(),a.suscribirseAConversacion(e)})),a.socket.on("newMessage",(function(e){console.log("newMessage"),a.pedirConversaciones(),a.receiveSound(e)})),a.socket.on("disconnect",(function(){alert("Ups! Se ha perdido la conexi\xf3n. Haz click en aceptar para volver a intentar.")}))},a.pedirConversaciones=function(){fetch("/mongo/getMyConversations/".concat(a.props.currentUser.id)).then((function(e){e.json().then((function(e){for(var n in e.sort(X),a.setState({conversaciones:e}),e)a.state.selectedConv&&e[n].numTelUsr===a.state.selectedConv.numTelUsr&&a.setState({selectedConv:e[n]}),a.suscribirseAConversacion(e[n].numTelUsr)}))}))},a.suscribirseAConversacion=function(e){a.socket.emit("suscribeTo",e),console.log("suscribed to ",e)},a.unsuscribeDeConversacion=function(e){a.socket.emit("unsuscribeFrom",e),console.log("unsuscribed from ",e)},a.firstLoad=function(){var e=a.props.chatkit.chatkit.currentUser,n=Object(d.a)({},e.rooms);n=Object.values(n);var s=function(s){n[s].mensajes=[],e.subscribeToRoomMultipart({roomId:n[s].id,hooks:{onMessage:function(e){a.addMessageToConversacion(e,n[s].id),a.playMessageSound(e)}},messageLimit:0}).then((function(){e.fetchMultipartMessages({roomId:n[s].id,direction:"older",limit:100}).then((function(e){for(var t in e)a.addMessageToConversacion(e[t],n[s].id)})).catch((function(e){console.log("Error fetching messages: ".concat(e))}))}))};for(var t in n)s(t);a.setState({conversaciones:n})},a.receiveSound=function(e){a.state.selectedConv&&e===a.state.selectedConv.numTelUsr?document.getElementById("newMessageAbiertoSound").play():document.getElementById("newMessageSound").play()},a.addMessageToConversacion=function(e,n){var s=Object(d.a)({},e);"whatsapp"===e.senderId.substring(0,8)?s.recibido=!0:"0000000000"===e.senderId.substring(0,10)?(s.recibido=!0,s.servidor=!0):s.recibido=!1;var t=Object(l.a)(a.state.conversaciones);for(var c in t)if(t[c].id===n){t[c].mensajes.push(s);break}t.sort(X),a.setState({conversaciones:t})},a.sendMessage=function(e,n){""!==e&&(a.setEsperando(!0),console.log(a.props.currentUser.id+" "+e+" "+n),fetch("/chatcenterkit/agentmessage",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({mensaje:e,from:a.props.currentUser.id,to:n,type:"text"})}).then((function(e){e.json().then((function(e){var s=e.find((function(e){return e.numTelUsr===n}));a.setState({conversaciones:e,selectedConv:s}),document.getElementById("sendMessageSound").play(),a.setEsperando(!1)}))})).catch((function(e){return console.log(e)})))},a.setConversaciones=function(e){a.setState({conversaciones:e})},a.setHistorial=function(e){e||(a.socket=$()("https://my-chat-kit.herokuapp.com/"),a.pedirConversaciones(),a.configurarSocket()),a.setState({historial:e})},a.renderChiquito=function(){return Object(t.jsxs)("div",{className:"row fullHeight",children:[a.state.principal&&Object(t.jsxs)("div",{className:"col-12 noPadding",children:[Object(t.jsx)(G,{currentUser:a.props.currentUser,setSelected:a.setSelected,logout:a.props.logout,setConversaciones:a.setConversaciones,setHistorial:a.setHistorial,historial:a.state.historial}),Object(t.jsx)(O,{selected:a.state.selectedConv,conversaciones:a.state.conversaciones,handleClick:a.handleClick,historial:a.state.historial})]}),!a.state.principal&&Object(t.jsx)("div",{className:"col-12 noPadding",children:Object(t.jsx)(R,{usuario:a.props.currentUser.name,currentUser:a.props.currentUser,selected:a.state.selectedConv,handleBack:a.handleBack,handleTerminarConversacion:a.handleTerminarConversacion,sendMessage:a.sendMessage,historial:a.state.historial,handleTransferir:a.handleTransferir,setSelected:a.setSelected,setConversaciones:a.setConversaciones,esperando:a.state.esperando,setEsperando:a.setEsperando})})]})},a.renderGrande=function(){return Object(t.jsxs)("div",{className:"row fullHeight",children:[Object(t.jsxs)("div",{className:"col-3 noPadding",children:[Object(t.jsx)(G,{currentUser:a.props.currentUser,setSelected:a.setSelected,logout:a.props.logout,setConversaciones:a.setConversaciones,setHistorial:a.setHistorial,historial:a.state.historial}),Object(t.jsx)(O,{selected:a.state.selectedConv,conversaciones:a.state.conversaciones,handleClick:a.handleClick,historial:a.state.historial})]}),Object(t.jsx)("div",{className:"col-9 noPadding",children:Object(t.jsx)(R,{usuario:a.props.currentUser.name,currentUser:a.props.currentUser,selected:a.state.selectedConv,handleBack:a.handleBack,handleTerminarConversacion:a.handleTerminarConversacion,sendMessage:a.sendMessage,historial:a.state.historial,handleTransferir:a.handleTransferir,setSelected:a.setSelected,setConversaciones:a.setConversaciones,esperando:a.state.esperando,setEsperando:a.setEsperando})})]})},a.handleClick=function(e){a.state.windowDimensions.width>750?a.setState({selectedConv:e}):(a.setState({selectedConv:e}),a.setState({principal:!1}))},a.handleBack=function(){a.setState({principal:!0}),a.setState({selectedConv:void 0})},a.setSelected=function(e){a.setState({selectedConv:e})},a.setEsperando=function(e){a.setState({esperando:e})},a.state={principal:!0,selectedConv:void 0,windowDimensions:Q(),conversaciones:[],historial:!1,esperando:!1},a}return Object(p.a)(s,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",this.handleClose),window.addEventListener("resize",this.handleResize),this.configurarSocket(),setInterval((function(){fetch("https://my-chat-kit.herokuapp.com/monitor").then((function(e){e.text().then((function(e){return console.log(e)}))}))}),15e5),fetch("/auth/login",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:sessionStorage.id,password:sessionStorage.password})})}},{key:"render",value:function(){return Object(t.jsxs)("div",{children:[Object(t.jsx)("audio",{id:"sendMessageSound",src:z,preload:"true"}),Object(t.jsx)("audio",{id:"newMessageSound",src:J,preload:"true"}),Object(t.jsx)("audio",{id:"newConversacionSound",src:K,preload:"true"}),Object(t.jsx)("audio",{id:"newMessageAbiertoSound",src:W,preload:"true"}),Object(t.jsxs)("div",{className:"container-fluid fullScreen",children:[this.state.windowDimensions.width>750&&this.renderGrande(),this.state.windowDimensions.width<=750&&this.renderChiquito()]})]})}}]),s}(a.Component),Z=(s(120),s.p+"static/media/ChatCenterLogo.2fd93857.svg");var ee=function(e){var n=Object(a.useRef)(),s=Object(a.useRef)();return Object(t.jsxs)("div",{className:"contenedorLogin",children:[Object(t.jsx)("img",{src:Z,alt:"Chat Center Logo",className:"logo"}),Object(t.jsx)("h1",{children:"\xa1Bienvenido a ChatCenter!"}),Object(t.jsx)("h6",{children:"Por favor ingresa tu numero de cedula y contrase\xf1a"}),Object(t.jsx)("input",{className:"inputLogin",type:"text",ref:n,placeholder:"C\xe9dula"}),Object(t.jsx)("br",{}),Object(t.jsx)("input",{className:"inputLogin",type:"text",ref:s,placeholder:"Contrase\xf1a"}),Object(t.jsx)("br",{}),Object(t.jsx)("button",{className:"botonLogin",onClick:function(){fetch("/auth/login",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:n.current.value,password:s.current.value})}).then((function(n){n.json().then((function(n){n.error?alert(n.error):(console.log(n),sessionStorage.id=n.id,sessionStorage.nombre=n.nombre,sessionStorage.password=s.current.value,e.setUser(n))}))}))},children:"Entrar"})]})};s(121);var ne=function(){var e=Object(a.useState)(sessionStorage.id?{id:sessionStorage.id,nombre:sessionStorage.nombre}:void 0),n=Object(i.a)(e,2),s=n[0],c=n[1];return Object(a.useEffect)((function(){}),[]),Object(t.jsxs)("div",{children:[s&&Object(t.jsx)(Y,{currentUser:s,logout:c}),!s&&Object(t.jsx)(ee,{setUser:c})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(t.jsx)(c.a.StrictMode,{children:Object(t.jsx)(ne,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},60:function(e,n,s){},62:function(e,n,s){},63:function(e,n,s){},64:function(e,n,s){},65:function(e,n,s){},66:function(e,n,s){},83:function(e,n,s){},84:function(e,n,s){},85:function(e,n,s){},86:function(e,n,s){},87:function(e,n,s){},88:function(e,n,s){},89:function(e,n,s){}},[[122,1,2]]]);
//# sourceMappingURL=main.7d650699.chunk.js.map